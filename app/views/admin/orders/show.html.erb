<h1>注文履歴詳細</h1>


<table>
    <tr><th>購入者</th><td><%=link_to @order.name,admin_customer_path(@order.customer.id)%></td></tr><%#(customer.id)だけだとundefined local variable or method `customerエラーになるなぜならcustomerの定義をコントやビューでしていないからだから@orderをつける%>
    
    <tr><th>注文日</th><td><%=@order.created_at%></td></tr>
    <tr><th>配送先</th><td><%=@order.address%></td></tr>
    <tr><th>支払方法</th><td><%=@order.payment_method%></td></tr>
    <tr><th>注文ステータス</th>
    <td><%=form_with model: @order,url: admin_order_path do |f| %>
   <%=f.select :order_status,[["waiting"], ["confirmation"], ["paid_up"],["preparing"],["shipped"]]%></td>
   <td><%=f.submit '更新'%></td></tr>
   <%end%>
</table>

<table>
    <thead>
        <tr>
            <th>商品名</th>
            <th>単価(税込)</th>
            <th>数量</th>
            <th>小計</th>
            <th>製作ステータス</tH>
        </tr>
    </thead>
    <tbody>
        <% @order_details.each do |order_detail|%>
        <tr>
            <td><%=order_detail.item.name%></td> 
            <td><%=order_detail.item.with_tax_price%></td>
            <td><%=order_detail.amount%></td>
            <td><%=order_detail.item.with_tax_price*order_detail.amount%><td>
            <td><%@sum+=order_detail.item.with_tax_price*order_detail.amount%></td>    
            <td> <%=form_with model: order_detail,url: admin_order_detail_path(order_detail) do |f| %>　<%#patch書かなくても元々フォームに値が入っていると勝手にpatchになる%>
             <%=f.select :making_status,[["impossible_manufacture"], ["waiting_manufacture"], ["manufacturing"],["finish"]]%></td>
            <td><%=f.submit '更新'%></td>
            <%end%>
        </tr>
        <%end%>
    </tbody>
</table>

<table>
    <tr><th>商品合計</th><td><%=@sum%></td></tr>
    <tr><th>送料</th><td><%=@postage%></td></tr>
    <tr><th>請求金額合計</th><td><%=@sum+=@postage%></td></tr>
</table>